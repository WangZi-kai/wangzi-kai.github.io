LastNo=0;SPACECHAR=" ";CandChinesePart=new Array();CandCompPart=new Array();AsciiStr="a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z";AsciiStr=AsciiStr.split(",");CtrlDown=false;CancelKey=false;passNextKeyPress=true;Punct2=new Array("\uff1b","\uff1d","\uff0c","\uff0d","\u3002","\uff0f","\uff40");Punct3=new Array("\uff3b","\u3001","\uff3d","\uff07");SPunct1=new Array("\uff09","\uff01","\uff20","\uff03","\uff04","\uff05","\uff3e","\uff06","\uff0a","\uff08");SPunct2=new Array("\uff1a","\uff0b","\uff1c","\uff3f","\uff1e","\uff1f","\uff5e");SPunct3=new Array("\uff5b","\uff5c","\uff5d","\uff02");FullShape_No=new Array("\uff10","\uff11","\uff12","\uff13","\uff14","\uff15","\uff16","\uff17","\uff18","\uff19");FullShape_BigAZ=new Array("\uff21","\uff22","\uff23","\uff24","\uff25","\uff26","\uff27","\uff28","\uff29","\uff2a","\uff2b","\uff2c","\uff2d","\uff2e","\uff2f","\uff30","\uff31","\uff32","\uff33","\uff34","\uff35","\uff36","\uff37","\uff38","\uff39","\uff3a");FullShape_SmallAZ=new Array("\uff41","\uff42","\uff43","\uff44","\uff45","\uff46","\uff47","\uff48","\uff49","\uff4a","\uff4b","\uff4c","\uff4d","\uff4e","\uff4f","\uff50","\uff51","\uff52","\uff53","\uff54","\uff55","\uff56","\uff57","\uff58","\uff59","\uff5a");function FindIn(d){var f=-1,a=0,c=0,e=CodeList.length;var b="";while(a<e){c=(a+e)/2;c=Math.floor(c);b=CodeList[c];if(b.indexOf(d,0)==0){f=c;break}b=CodeList[c-1];if(b.indexOf(d,0)==0){f=c;break}if(b<d){a=c+1}else{e=c-1}}while(f>0){b=CodeList[f-1];if(b.indexOf(d,0)==0){f--}else{break}}return(f)}function GetStr(a,c){var e="",d="";var b;for(b=0;b<=9;b++){if(a+b>CodeList.length-1){break}e=CodeList[a+b];if(e.indexOf(c)==0){d=CodeList[a+b];CandCompPart[b]=d.substring(c.length,d.indexOf(SPACECHAR));CandChinesePart[b]=d.substr(d.lastIndexOf(SPACECHAR)+1);if(b<=8){IME.Cand.value+=(b+1)+"."+CandChinesePart[b]+CandCompPart[b]+"\n"}else{IME.Cand.value+=(0)+"."+CandChinesePart[b]+CandCompPart[b]+"\n"}}else{break}}if(a>10&&CodeList[a-10].indexOf(c)==0){IME.Cand.value+="-.\u2190\n"}if(b==10&&a<=CodeList.length-11&&CodeList[a+b].indexOf(c)==0){IME.Cand.value+="+.\u2192"}LastNo=a}function Grep(b){var a=-1;for(i=0;i<=9;i++){CandChinesePart[i]=""}if(b!=""){a=FindIn(b);if(a>=0){GetStr(a,b)}}if(IME.AutoUp.checked==true&&CandChinesePart[0]!=""&&CandChinesePart[1]==""&&CandCompPart[0]==""){SendCand(0)}}function SendCand(a){if(a>=0&&a<=9){SendStr(CandChinesePart[a]);IME.Comp.value="";IME.Cand.value=""}}function setSelectionRange(b,c,d){if(b.setSelectionRange){b.focus();b.setSelectionRange(c,d)}else{if(b.createTextRange){var a=b.createTextRange();a.collapse(true);a.moveEnd("character",d);a.moveStart("character",c);a.select()}}}function setCaretToEnd(a){setSelectionRange(a,a.value.length,a.value.length)}function setCaretToBegin(a){setSelectionRange(a,0,0)}function setCaretToPos(a,b){setSelectionRange(a,b,b)}function SendStr(c){if(c==""){return}switch(browser){case 1:var d=document.selection.createRange();d.text=c;d.select();break;case 2:var h=IME.InputArea;var e=h.selectionStart;var g=h.selectionEnd;var b=h.scrollTop;var f=h.scrollHeight;var a=h.value.length;h.value=h.value.substring(0,e)+c+h.value.substring(g);h.selectionStart=h.selectionEnd=e+c.length;if(h.value.length==a){h.scrollTop=h.scrollHeight}else{if(h.scrollHeight>f){h.scrollTop=b+h.scrollHeight-f}else{h.scrollTop=b}}break;default:IME.InputArea.value+=c}}function ToFullShapeLetter(a){var b="";for(i=0;i<a.length;i++){var d=a.charCodeAt(i);if(d>=65&&d<=90){b+=FullShape_BigAZ[d-65]}else{if(d>=97&&d<=122){b+=FullShape_SmallAZ[d-97]}else{b+=a.charAt(i)}}}return b}function ImeKeyDown(c){var b="";if(!c){c=window.event}var a=c.which?c.which:c.keyCode;CtrlDown=false;passNextKeyPress=false;switch(a){case 8:if(IME.Comp.value!=""){b=IME.Comp.value;IME.Comp.value=b.substr(0,b.length-1);IME.Cand.value="";Grep(IME.Comp.value);CancelKey=true;return(false)}return(true);case 9:SendStr("\u3000");CancelKey=true;return(false);case 27:IME.Comp.value="";IME.Cand.value="";CancelKey=true;return(false);case 109:case 189:case 33:b=IME.Comp.value;if(b!=""){if(LastNo>10&&CodeList[LastNo-10].indexOf(b)==0){IME.Cand.value="";GetStr(LastNo-10,b)}CancelKey=true;return(false)}break;case 107:case 61:case 187:case 34:b=IME.Comp.value;if(b!=""){if(LastNo<=CodeList.length-11&&CodeList[LastNo+10].indexOf(b)==0){IME.Cand.value="";GetStr(LastNo+10,b)}CancelKey=true;return(false)}break;case 32:if(IME.Comp.value!=""){SendCand(0);CancelKey=true;return(false)}return(true);case 13:if(IME.Comp.value!=""){SendStr(IME.FullShape.checked?ToFullShapeLetter(IME.Comp.value):IME.Comp.value);IME.Comp.value="";IME.Cand.value="";CancelKey=true;return(false)}return(true);case 113:IME.AutoUp.checked=!IME.AutoUp.checked;CancelKey=true;return(false);case 123:case 57356:IME.FullShape.checked=!IME.FullShape.checked;CancelKey=true;return(false);case 17:case 57402:CtrlDown=true;break;case 36:case 35:case 37:case 38:case 39:case 40:case 45:case 46:case 91:case 112:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:passNextKeyPress=true;return(true)}if(c.ctrlKey){return(true)}if(a>=48&&a<=57){if(c.shiftKey){if(IME.FullShape.checked||!IME.EnglishMode.checked){SendStr(SPunct1[a-48]);CancelKey=true;return(false)}}else{if(IME.Comp.value==""){if(IME.FullShape.checked||!IME.EnglishMode.checked){SendStr(FullShape_No[a-48]);CancelKey=true;return(false)}}else{if(!IME.EnglishMode.checked){SendCand(a==48?9:(a-49));CancelKey=true;return(false)}}}return(true)}if(IME.FullShape.checked||!IME.EnglishMode.checked){if(a>=186&&a<=192){SendStr(c.shiftKey?SPunct2[a-186]:Punct2[a-186]);CancelKey=true;return(false)}if(a>=219&&a<=222){SendStr(c.shiftKey?SPunct3[a-219]:Punct3[a-219]);CancelKey=true;return(false)}}if(browser==2){if(IME.FullShape.checked||!IME.EnglishMode.checked){switch(a){case 59:SendStr(c.shiftKey?SPunct2[0]:Punct2[0]);CancelKey=true;return(false);case 61:SendStr(c.shiftKey?SPunct2[1]:Punct2[1]);CancelKey=true;return(false);case 109:SendStr(c.shiftKey?SPunct2[3]:Punct2[3]);CancelKey=true;return(false)}}}return(true)}function ImeKeyPress(b){if(!b){b=window.event}var a=b.which?b.which:b.keyCode;if(passNextKeyPress){return(true)}if(browser==2||browser==3){if(CancelKey){CancelKey=false;return(false)}}if(b.ctrlKey){return(true)}if(a>=65&&a<=90){if(IME.FullShape.checked){SendStr(FullShape_BigAZ[a-65]);return(false)}return(true)}if(a>=97&&a<=122){if(IME.EnglishMode.checked){if(IME.FullShape.checked){SendStr(FullShape_SmallAZ[a-97]);return(false)}return(true)}else{s=IME.Comp.value;if(s.length<MAX){IME.Comp.value+=AsciiStr[a-97];IME.Cand.value="";Grep(IME.Comp.value)}return(false)}}if(browser==2){switch(a){case 47:case 63:if(!IME.EnglishMode.checked||IME.FullShape.checked){return(false)}break}}return(true)}function ImeKeyUp(b){if(!b){b=window.event}var a=b.which?b.which:b.keyCode;if(a==17||a==57402){if(CtrlDown==true){IME.EnglishMode.checked=!IME.EnglishMode.checked}}return(true)}function BodyOnLoad(){browser=(navigator.appName.indexOf("Microsoft")!=-1)?1:(navigator.appName.indexOf("Netscape")!=-1)?2:(navigator.appName.indexOf("Opera")!=-1)?3:4;if(browser==2&&navigator.userAgent.indexOf("Safari")!=-1){browser=5}IME={InputArea:document.getElementById("InputArea"),Comp:document.getElementById("Comp"),Cand:document.getElementById("Cand"),EnglishMode:document.getElementById("EnglishMode"),FullShape:document.getElementById("FullShape"),AutoUp:document.getElementById("AutoUp")};IME.InputArea.focus()}function LoadImeTable(){}function setCaret(a){if(a.createTextRange){a.caretPos=document.selection.createRange().duplicate()}}function insertAtCaret(a,b){if(document.all){if(a.createTextRange&&a.caretPos){var c=a.caretPos;c.text=c.text.charAt(c.text.length-1)=="   "?b+"   ":b}else{a.value=b}}else{if(a.setSelectionRange){var f=a.selectionStart;var e=a.selectionEnd;var g=a.value.substring(0,f);var d=a.value.substring(e);a.value=g+b+d}else{alert("This   version   of   Mozilla   based   browser   does   not   support   setSelectionRange")}}};
